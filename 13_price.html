
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Price Is Right Problem &#8212; Bite Size Bayes</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="The Binomial Distribution" href="12_binomial.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Bite Size Bayes</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="README.html">
   The notebooks
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01_linda.html">
   The Laws of Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_bayes.html">
   Bayes’s Theorem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_cookie.html">
   The Cookie Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_dice.html">
   The Dice Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_test.html">
   Medical Tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_pmf.html">
   Probability Mass Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_euro.html">
   The Euro Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_soccer.html">
   The World Cup Problem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_predict.html">
   Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_joint.html">
   Joint Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_faceoff.html">
   Comparisons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_binomial.html">
   The Binomial Distribution
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   <em>
    The Price Is Right
   </em>
   Problem
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/13_price.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/AllenDowney/BiteSizeBayes"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/AllenDowney/BiteSizeBayes/master?urlpath=tree/13_price.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#review">
   Review
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   The Price is Right problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-prior">
   The prior
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kernel-density-estimation">
   Kernel density estimation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distribution-of-error">
   Distribution of error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#update">
   Update
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#probability-of-winning">
   Probability of winning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#decision-analysis">
   Decision analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#maximizing-expected-gain">
   Maximizing expected gain
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Review
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="the-price-is-right-problem">
<h1><em>The Price Is Right</em> Problem<a class="headerlink" href="#the-price-is-right-problem" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/BiteSizeBayes/blob/master/09_predict.ipynb">In a previous notebook</a> we used the time between goals to update our estimate of the goal-scoring rate of a soccer team.</p>
<p>Under the assumption that goal-scoring is well-modeled by a Poisson process, the time between goals follows an <a class="reference external" href="https://en.wikipedia.org/wiki/Exponential_distribution">exponential distribution</a>.</p>
<p>In other words, if the goal-scoring rate is λ, the probability of seeing an interval between goals of <span class="math notranslate nohighlight">\(t\)</span> is proportional to the PDF of the exponential distribution:</p>
<p><span class="math notranslate nohighlight">\(f(t; λ) = λ~\exp(-λ t)\)</span></p>
<p>Because <span class="math notranslate nohighlight">\(t\)</span> is a continuous quantity, the value of this expression is not really a probability; technically it is a <a class="reference external" href="https://en.wikipedia.org/wiki/Probability_density_function">probability density</a>.  However, it is proportional to the probability of the data, so we can use it as a likelihood in a Bayesian update.</p>
<p>In this notebook, we’ll use the PDF of a normal distribution the same way, in order to estimate the value of prizes on a game show.
Once we compute a posterior distribution, we’ll use it to optimize a decision-making process.</p>
<p>This example demonstrates the real power of Bayesian methods, not just computing posterior distributions, but using them to make better decisions.</p>
</div>
<div class="section" id="id1">
<h2>The Price is Right problem<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>On November 1, 2007, contestants named Letia and Nathaniel appeared on <em>The Price is Right</em>, an American game show. They competed in a game called “The Showcase”, where the objective is to guess the price of a collection of prizes. The contestant who comes closest to the actual price, without going over, wins the prizes.</p>
<p>Nathaniel went first. His showcase included a dishwasher, a wine cabinet, a laptop computer, and a car. He bid $26,000.</p>
<p>Letia’s showcase included a pinball machine, a video arcade game, a pool table, and a cruise of the Bahamas. She bid $21,500.</p>
<p>The actual price of Nathaniel’s showcase was $25,347. His bid was too high, so he lost.</p>
<p>The actual price of Letia’s showcase was $21,578.</p>
<p>She was only off by $78, so she won her showcase and, because her bid was off by less than 250, she also won Nathaniel’s showcase.</p>
<p>For a Bayesian thinker, this scenario suggests several questions:</p>
<ol class="simple">
<li><p>Before seeing the prizes, what prior beliefs should the contestant have about the price of the showcase?</p></li>
<li><p>After seeing the prizes, how should the contestant update those beliefs?</p></li>
<li><p>Based on the posterior distribution, what should the contestant bid?</p></li>
</ol>
<p>The third question demonstrates a common use of Bayesian methods: <a class="reference external" href="https://en.wikipedia.org/wiki/Decision_analysis">decision analysis</a>.</p>
<p>This problem is inspired by <a class="reference external" href="https://nbviewer.jupyter.org/github/CamDavidsonPilon/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers/blob/master/Chapter5_LossFunctions/Ch5_LossFunctions_PyMC3.ipynb">this example</a> in Cameron Davidson-Pilon’s book, <a class="reference external" href="http://camdavidsonpilon.github.io/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers">Probablistic Programming and Bayesian Methods for Hackers</a>.</p>
</div>
<div class="section" id="the-prior">
<h2>The prior<a class="headerlink" href="#the-prior" title="Permalink to this headline">¶</a></h2>
<p>To choose a prior distribution of prices, we can take advantage of data from previous episodes. Fortunately, <a class="reference external" href="https://web.archive.org/web/20121107204942/http://www.tpirsummaries.8m.com/">fans of the show keep detailed records</a>.</p>
<p>For this example, I downloaded files containing the price of each showcase from the 2011 and 2012 seasons and the bids offered by the contestants.</p>
<p>The following cells load the data files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the data files</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;showcases.2011.csv&#39;</span><span class="p">):</span>
    <span class="o">!</span>wget https://github.com/AllenDowney/BiteSizeBayes/raw/master/showcases.2011.csv

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;showcases.2012.csv&#39;</span><span class="p">):</span>
    <span class="o">!</span>wget http://github.com/AllenDowney/BiteSizeBayes/raw/master/showcases.2012.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2021-03-29 10:29:34--  https://github.com/AllenDowney/BiteSizeBayes/raw/master/showcases.2011.csv
Resolving github.com (github.com)... 140.82.113.3
Connecting to github.com (github.com)|140.82.113.3|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://raw.githubusercontent.com/AllenDowney/BiteSizeBayes/master/showcases.2011.csv [following]
--2021-03-29 10:29:34--  https://raw.githubusercontent.com/AllenDowney/BiteSizeBayes/master/showcases.2011.csv
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.108.133, 185.199.109.133, 185.199.111.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.108.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 10596 (10K) [text/plain]
Saving to: ‘showcases.2011.csv’

showcases.2011.csv  100%[===================&gt;]  10.35K  --.-KB/s    in 0.003s  

2021-03-29 10:29:34 (3.25 MB/s) - ‘showcases.2011.csv’ saved [10596/10596]

URL transformed to HTTPS due to an HSTS policy
--2021-03-29 10:29:34--  https://github.com/AllenDowney/BiteSizeBayes/raw/master/showcases.2012.csv
Resolving github.com (github.com)... 140.82.113.3
Connecting to github.com (github.com)|140.82.113.3|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: https://raw.githubusercontent.com/AllenDowney/BiteSizeBayes/master/showcases.2012.csv [following]
--2021-03-29 10:29:34--  https://raw.githubusercontent.com/AllenDowney/BiteSizeBayes/master/showcases.2012.csv
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.109.133, 185.199.111.133, 185.199.110.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.109.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 6714 (6.6K) [text/plain]
Saving to: ‘showcases.2012.csv’

showcases.2012.csv  100%[===================&gt;]   6.56K  --.-KB/s    in 0s      

2021-03-29 10:29:34 (20.1 MB/s) - ‘showcases.2012.csv’ saved [6714/6714]
</pre></div>
</div>
</div>
</div>
<p>The following function reads the data and cleans it up a little.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read the showcase price data.</span>
<span class="sd">    </span>
<span class="sd">    filename: string</span>
<span class="sd">    </span>
<span class="sd">    returns: DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>I’ll read both files and concatenate them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2011</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;showcases.2011.csv&#39;</span><span class="p">)</span>
<span class="n">df2011</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(191, 6)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2012</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;showcases.2012.csv&#39;</span><span class="p">)</span>
<span class="n">df2012</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(122, 6)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df2011</span><span class="p">,</span> <span class="n">df2012</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(313, 6)
</pre></div>
</div>
</div>
</div>
<p>Here’s what the dataset looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Showcase 1</th>
      <th>Showcase 2</th>
      <th>Bid 1</th>
      <th>Bid 2</th>
      <th>Difference 1</th>
      <th>Difference 2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50969.0</td>
      <td>45429.0</td>
      <td>42000.0</td>
      <td>34000.0</td>
      <td>8969.0</td>
      <td>11429.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>21901.0</td>
      <td>34061.0</td>
      <td>14000.0</td>
      <td>59900.0</td>
      <td>7901.0</td>
      <td>-25839.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32815.0</td>
      <td>53186.0</td>
      <td>32000.0</td>
      <td>45000.0</td>
      <td>815.0</td>
      <td>8186.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>44432.0</td>
      <td>31428.0</td>
      <td>27000.0</td>
      <td>38000.0</td>
      <td>17432.0</td>
      <td>-6572.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24273.0</td>
      <td>22320.0</td>
      <td>18750.0</td>
      <td>23000.0</td>
      <td>5523.0</td>
      <td>-680.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="kernel-density-estimation">
<h2>Kernel density estimation<a class="headerlink" href="#kernel-density-estimation" title="Permalink to this headline">¶</a></h2>
<p>This dataset contains the prices for 313 previous showcases, which we can think of as a sample from the population of possible prices.</p>
<p>We can use this sample to estimate the prior distribution of showcase prices.  One way to do that is kernel density estimation (KDE), which uses the sample to estimate a smooth distribution.</p>
<p>SciPy provides <code class="docutils literal notranslate"><span class="pre">gaussian_kde</span></code>, which takes a sample and returns an object that represents the estimated distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>

<span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Showcase 1&#39;</span><span class="p">])</span>
<span class="n">kde</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;scipy.stats.kde.gaussian_kde at 0x7f4225675950&gt;
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">kde</span></code> to evaluate the estimated distribution for a sequence of values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">81</span><span class="p">)</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And put the results into a normalized Series that represents the prior distribution for Showcase 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_pmf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make a Series that represents a PMF.</span>
<span class="sd">    </span>
<span class="sd">    xs: sequence of values</span>
<span class="sd">    ps: sequence of probabilities</span>
<span class="sd">    options: keyword arguments passed to Series constructor</span>
<span class="sd">    </span>
<span class="sd">    returns: Pandas Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pmf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pmf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prior1</span> <span class="o">=</span> <span class="n">make_pmf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span>
<span class="n">prior1</span> <span class="o">/=</span> <span class="n">prior1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what it looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prior1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Showcase value ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prior distribution of showcase value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_27_0.png" src="_images/13_price_27_0.png" />
</div>
</div>
<p>The following function takes a sample, makes a KDE, evaluates it at a given sequence of <code class="docutils literal notranslate"><span class="pre">xs</span></code>, and returns the result as a normalized PMF.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_kde</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">sample</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make a PMF based on KDE:</span>
<span class="sd">    </span>
<span class="sd">    xs: places where we should evaluate the KDE</span>
<span class="sd">    sample: sequence of values</span>
<span class="sd">    </span>
<span class="sd">    returns: Series that represents a normalized PMF</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">pmf</span> <span class="o">=</span> <span class="n">make_pmf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span>
    <span class="n">pmf</span> <span class="o">/=</span> <span class="n">pmf</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pmf</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Exercise:</strong> Use this function to make a Pmf that represents the prior distribution for Showcase 2, and plot it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">71</span><span class="p">)</span>
<span class="n">prior2</span> <span class="o">=</span> <span class="n">make_kde</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Showcase 2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prior1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 1&#39;</span><span class="p">)</span>
<span class="n">prior2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Showcase value ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prior and posterior distribution of showcase value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_32_0.png" src="_images/13_price_32_0.png" />
</div>
</div>
</div>
<div class="section" id="distribution-of-error">
<h2>Distribution of error<a class="headerlink" href="#distribution-of-error" title="Permalink to this headline">¶</a></h2>
<p>To update these priors, we have to answer these questions:</p>
<ul class="simple">
<li><p>What data should we consider and how should we quantify it?</p></li>
<li><p>Can we compute a likelihood function; that is, for each hypothetical price, can we compute the conditional likelihood of the data?</p></li>
</ul>
<p>To answer these questions, I will model the contestant as a price-guessing instrument with known error characteristics. In other words, when the contestant sees the prizes, they guess the price of each prize — ideally without taking into consideration the fact that the prize is part of a showcase — and add up the prices. Let’s call this total <code class="docutils literal notranslate"><span class="pre">guess</span></code>.</p>
<p>Under this model, the question we have to answer is, “If the actual price is <code class="docutils literal notranslate"><span class="pre">price</span></code>, what is the likelihood that the contestant’s estimate would be <code class="docutils literal notranslate"><span class="pre">guess</span></code>?”</p>
<p>Equivalently, if we define <code class="docutils literal notranslate"><span class="pre">error</span> <span class="pre">=</span> <span class="pre">guess</span> <span class="pre">-</span> <span class="pre">price</span></code>, we can ask, “What is the likelihood that the contestant’s estimate is off by <code class="docutils literal notranslate"><span class="pre">error</span></code>?”</p>
<p>To answer this question, I’ll use the historical data again. For each showcase in the dataset, let’s look at the difference between the contestant’s bid and the actual price:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_diff1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Bid 1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Showcase 1&#39;</span><span class="p">]</span>
<span class="n">sample_diff2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Bid 2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Showcase 2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>To visualize the distribution of these differences, we can use KDE again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">40000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
<span class="n">kde_diff1</span> <span class="o">=</span> <span class="n">make_kde</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span>
<span class="n">kde_diff2</span> <span class="o">=</span> <span class="n">make_kde</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kde_diff1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Diff 1&#39;</span><span class="p">)</span>
<span class="n">kde_diff2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Diff 2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Difference in value ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Difference between bid and actual value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_37_0.png" src="_images/13_price_37_0.png" />
</div>
</div>
<p>It looks like the bids are too low more often than too high, which makes sense.  Remember that under the rules of the game, you lose if you overbid, so contestants probably underbid to some degree deliberately.</p>
<p>Here is the mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">Diff</span></code> for Player 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_diff1</span> <span class="o">=</span> <span class="n">sample_diff1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std_diff1</span> <span class="o">=</span> <span class="n">sample_diff1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">mean_diff1</span><span class="p">,</span> <span class="n">std_diff1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-4116.3961661341855, 6899.909806377117)
</pre></div>
</div>
</div>
</div>
<p>We can use the observed distribution of differences to model the contestant’s distribution of errors.</p>
<p>This step is a little tricky because we don’t actually know the contestant’s guesses; we only know what they bid.</p>
<p>So we have to make some assumptions:</p>
<ul class="simple">
<li><p>I’ll assume that contestants underbid because they are being strategic, and that on average their guesses are accurate.  In other word, the mean of their errors is 0.</p></li>
<li><p>But I’ll assume that the spread of the differences reflects the actual spread of their errors.  So, I’ll use the standard deviation of the differences as the standard deviation of their errors.</p></li>
</ul>
<p>Based on these assumptions, I’ll make a normal distribution with parameters 0 and <code class="docutils literal notranslate"><span class="pre">std_diff1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="n">error_dist1</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">std_diff1</span><span class="p">)</span>
<span class="n">error_dist1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;scipy.stats._distn_infrastructure.rv_frozen at 0x7f4223185750&gt;
</pre></div>
</div>
</div>
</div>
<p>We’ll use this distribution to do the update.</p>
</div>
<div class="section" id="update">
<h2>Update<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h2>
<p>Suppose you are Player 1.  You see the prizes in your showcase and your estimate of the total price is $23,000.</p>
<p>For each hypothetical price in the prior distribution, I’ll subtract away your guess.
The result is your error under each hypothesis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">guess1</span> <span class="o">=</span> <span class="mi">23000</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">prior1</span><span class="o">.</span><span class="n">index</span>
<span class="n">error1</span> <span class="o">=</span> <span class="n">guess1</span> <span class="o">-</span> <span class="n">xs</span>
</pre></div>
</div>
</div>
</div>
<p>Now suppose you know based on past performance that your estimation error is well modeled by <code class="docutils literal notranslate"><span class="pre">error_dist1</span></code>.</p>
<p>Under that assumption we can compute the likelihood of your estimate under each hypothesis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood1</span> <span class="o">=</span> <span class="n">error_dist1</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">error1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And we can use that likelihood to update the prior.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">posterior1</span> <span class="o">=</span> <span class="n">prior1</span> <span class="o">*</span> <span class="n">likelihood1</span>
<span class="n">posterior1</span> <span class="o">/=</span> <span class="n">posterior1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what the posterior distribution looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prior1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 1&#39;</span><span class="p">)</span>
<span class="n">posterior1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior 1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Showcase value ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prior and posterior distribution of showcase value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_50_0.png" src="_images/13_price_50_0.png" />
</div>
</div>
<p>Because your estimate is in the lower end of the range, the posterior distribution has shifted to the left.  We can use the posterior mean to see by how much.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pmf_mean</span><span class="p">(</span><span class="n">pmf</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the mean of a PMF.</span>
<span class="sd">    </span>
<span class="sd">    pmf: Series representing a PMF</span>
<span class="sd">    </span>
<span class="sd">    return: float</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pmf</span><span class="o">.</span><span class="n">index</span> <span class="o">*</span> <span class="n">pmf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_mean</span><span class="p">(</span><span class="n">prior1</span><span class="p">),</span> <span class="n">pmf_mean</span><span class="p">(</span><span class="n">posterior1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(30299.488817891375, 26192.024002392536)
</pre></div>
</div>
</div>
</div>
<p>Before you saw the prizes, you expected to see a showcase with a value close to $30,000.</p>
<p>After making an estimate of $23,000, you updated the prior distribution.</p>
<p>Based on the combination of the prior and your estimate, you now expect the actual price to be about $26,000.</p>
<p><strong>Exercise:</strong> Now suppose you are Player 2.  When you see your showcase, you estimte that the total price is $38,000.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">diff2</span></code> to construct a normal distribution that represents the distribution of your estimation errors.</p>
<p>Compute the likelihood of your estimate for each actual price and use it to update <code class="docutils literal notranslate"><span class="pre">prior2</span></code>.</p>
<p>Plot the posterior distribution and compute the posterior mean.  Based on your estimate, what do you expect the actual price of the showcase to be?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">mean_diff2</span> <span class="o">=</span> <span class="n">sample_diff2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std_diff2</span> <span class="o">=</span> <span class="n">sample_diff2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">mean_diff2</span><span class="p">,</span> <span class="n">std_diff2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-3675.891373801917, 6886.260711323408)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">error_dist2</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">std_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">guess2</span> <span class="o">=</span> <span class="mi">38000</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">prior2</span><span class="o">.</span><span class="n">index</span>
<span class="n">error2</span> <span class="o">=</span> <span class="n">guess2</span> <span class="o">-</span> <span class="n">xs</span>

<span class="n">likelihood2</span> <span class="o">=</span> <span class="n">error_dist2</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">error2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">posterior2</span> <span class="o">=</span> <span class="n">prior2</span> <span class="o">*</span> <span class="n">likelihood2</span>
<span class="n">posterior2</span> <span class="o">/=</span> <span class="n">posterior2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prior2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 2&#39;</span><span class="p">)</span>
<span class="n">posterior2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior 2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Showcase value ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prior and posterior distribution of showcase value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_60_0.png" src="_images/13_price_60_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">pmf_mean</span><span class="p">(</span><span class="n">prior2</span><span class="p">),</span> <span class="n">pmf_mean</span><span class="p">(</span><span class="n">posterior2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(31047.686915520928, 34305.20163595075)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="probability-of-winning">
<h2>Probability of winning<a class="headerlink" href="#probability-of-winning" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a posterior distribution for each player, let’s think about strategy.</p>
<p>First, from the point of view of Player 1, let’s compute the probability that Player 2 overbids.  To keep it simple, I’ll use only the performance of past players, ignoring the estimated value of the showcase.</p>
<p>The following function takes a sequence of past bids and returns the fraction that overbid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prob_overbid</span><span class="p">(</span><span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the probability this player overbids.</span>

<span class="sd">    sample_diff: sequence of differences</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s an estimate for the probability that Player 2 overbids.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_overbid</span><span class="p">(</span><span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.29073482428115016
</pre></div>
</div>
</div>
</div>
<p>Now suppose Player 1 underbids by $5000.
What is the probability that Player 2 underbids by more?</p>
<p>The following function uses past performance to estimate the probabily that a player underbids by more than a given amount, <code class="docutils literal notranslate"><span class="pre">diff</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prob_worse_than</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Probability the opponents&#39;s diff is worse than the given diff.</span>

<span class="sd">    diff: how much the oppenent is off by (always negative)</span>
<span class="sd">    sample_diff: sequence of differences for the opponent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample_diff</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s the probability that Player 2 underbids by more than $5000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_worse_than</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.38338658146964855
</pre></div>
</div>
</div>
</div>
<p>And here’s the probability they are off by more than $10,000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_worse_than</span><span class="p">(</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.14376996805111822
</pre></div>
</div>
</div>
</div>
<p>We can combine these function to compute the probability that Player 1 wins, given the difference between their bid and the actual price:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_prob_win</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the probability of winning for a given diff.</span>

<span class="sd">    diff: how much your bid was off by</span>
<span class="sd">    sample_diff: sequence of differences for the opponent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if you overbid you lose</span>
    <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># if the opponent over bids, you win</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">prob_overbid</span><span class="p">(</span><span class="n">sample_diff</span><span class="p">)</span>
    
    <span class="c1"># or of their bid is worse than yours, you win</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">prob_worse_than</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s the probability that you win, given that you underbid by $5000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_prob_win</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6741214057507987
</pre></div>
</div>
</div>
</div>
<p>Now let’s look at the probability of winning for a range of possible differences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">30000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">compute_prob_win</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Difference between guess and actual price ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability of winning&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Player 1&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_77_0.png" src="_images/13_price_77_0.png" />
</div>
</div>
<p>If you underbid by $30,000, the chance of winning is about 30%, which is mostly the chance your opponent overbids.</p>
<p>As your bids gets closer to the actual price, your chance of winning approaches 1.</p>
<p>And, of course, if you overbid, you lose (even if your opponent also overbids).</p>
<p><strong>Exercise:</strong> Run the same analysis from the point of view of Player 2.  Using the sample of differences from Player 1, compute:</p>
<ol class="simple">
<li><p>The probability that Player 1 overbids.</p></li>
<li><p>The probability that Player 1 underbids by more than $5000.</p></li>
<li><p>The probability that Player 2 wins, given that they underbid by $5000.</p></li>
</ol>
<p>Then plot the probability that Player 2 wins for a range of possible differences between their bid and the actual price.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_overbid</span><span class="p">(</span><span class="n">sample_diff1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.24600638977635783
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_worse_than</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3993610223642173
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_prob_win</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6453674121405751
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">30000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">compute_prob_win</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Difference between guess and actual price ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability of winning&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Player 2&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_83_0.png" src="_images/13_price_83_0.png" />
</div>
</div>
</div>
<div class="section" id="decision-analysis">
<h2>Decision analysis<a class="headerlink" href="#decision-analysis" title="Permalink to this headline">¶</a></h2>
<p>In the previous section we computed the probability of winning, given that we have underbid by a particular amount.</p>
<p>In reality the contestants don’t know how much they have underbid by, because they don’t know the actual price.</p>
<p>But they do have a posterior distribution that represents their beliefs about the actual price, and they can use that to estimate their probability of winning with a given bid.</p>
<p>The following function take a possible bid, a posterior distribution of actual prices, and a sample of differences for the opponent.</p>
<p>It loops through the hypothetical prices in the posterior distribution and for each price:</p>
<ol class="simple">
<li><p>Computes the difference between the bid and the hypothetical price.</p></li>
<li><p>Computes the probability that the player wins, given that difference.</p></li>
<li><p>Adds up the weighted sum of the probabilities, where the weights are the probabilites in the posterior distribution.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">total_prob_win</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the total probability of winning with a given bid.</span>

<span class="sd">    bid: your bid</span>
<span class="sd">    posterior: Pmf of showcase value</span>
<span class="sd">    sample_diff: sequence of differences for the opponent</span>
<span class="sd">    </span>
<span class="sd">    returns: probability of winning</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">price</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">posterior</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">bid</span> <span class="o">-</span> <span class="n">price</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">compute_prob_win</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
</div>
</div>
<p>This loop implements the law of total probability:</p>
<p><span class="math notranslate nohighlight">\(P(win) = \sum_{price} P(price) ~ P(win ~|~ price)\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_prob_win</span><span class="p">(</span><span class="mi">25000</span><span class="p">,</span> <span class="n">posterior1</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4842210945439812
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bids</span> <span class="o">=</span> <span class="n">posterior1</span><span class="o">.</span><span class="n">index</span>

<span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">total_prob_win</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior1</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span> 
         <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">bids</span><span class="p">]</span>

<span class="n">prob_win_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_win_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bid ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability of winning&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Player 1&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_89_0.png" src="_images/13_price_89_0.png" />
</div>
</div>
<p>And here’s the bid that maximizes your chance of winning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_win_series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>21000.0
</pre></div>
</div>
</div>
</div>
<p>Recall that your estimate was $23,000.</p>
<p>After using your estimate to compute the posterior distribution, the posterior mean is about $26,000.</p>
<p>But the bid that maximizes your chance of winning is $21,000.</p>
<p><strong>Exercise:</strong> Do the same analysis for Player 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">bids</span> <span class="o">=</span> <span class="n">posterior2</span><span class="o">.</span><span class="n">index</span>

<span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">total_prob_win</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior2</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span> 
         <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">bids</span><span class="p">]</span>

<span class="n">prob_win_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prob_win_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bid ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability of winning&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Player 2&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_95_0.png" src="_images/13_price_95_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prob_win_series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>29000.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="maximizing-expected-gain">
<h2>Maximizing expected gain<a class="headerlink" href="#maximizing-expected-gain" title="Permalink to this headline">¶</a></h2>
<p>In the previous section we computed the bid that maximizes your chance of winning.
And if that’s your goal, the bid we computed is optimal.</p>
<p>But winning isn’t everything.
Remember that if your bid is off by $250 or less, you will both showcases.
So it might be a good idea to increase your bid a little: it increases the chance you overbid and lose, but it also increases the chance of winning both showcases.</p>
<p>Let’s see how that works out.
The following function computes how much you will win, on average, given your bid, the actual price, and a sample of errors for your opponent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes expected gain given a bid and actual price.</span>

<span class="sd">    bid: number</span>
<span class="sd">    price: actual price</span>
<span class="sd">    sample_diff: sequence of differences for the opponent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">bid</span> <span class="o">-</span> <span class="n">price</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">compute_prob_win</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">)</span>

    <span class="c1"># if you are within 250 dollars, you win both showcases</span>
    <span class="k">if</span> <span class="o">-</span><span class="mi">250</span> <span class="o">&lt;=</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">price</span> <span class="o">*</span> <span class="n">prob</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">price</span> <span class="o">*</span> <span class="n">prob</span>
</pre></div>
</div>
</div>
</div>
<p>For example, if the actual price is $35000</p>
<p>and you bid $30000,</p>
<p>you will win about $23,600 worth of prizes on average.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_gain</span><span class="p">(</span><span class="mi">30000</span><span class="p">,</span> <span class="mi">35000</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>23594.249201277955
</pre></div>
</div>
</div>
</div>
<p>In reality we don’t know the actual price, but we have a posterior distribution that represents what we know about it.
By averaging over the prices and probabilities in the posterior distribution, we can compute the “expected gain” for a particular bid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">expected_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the expected return of a given bid.</span>

<span class="sd">    bid: your bid</span>
<span class="sd">    posterior: distribution of showcase values</span>
<span class="sd">    sample_diff: distribution of differences for the opponent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">price</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">posterior</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">compute_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
</div>
</div>
<p>For the posterior we computed earlier, based on an estimate of $23,000,</p>
<p>the expected gain for a bid of $21,000</p>
<p>is about $16,900.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain</span><span class="p">(</span><span class="mi">21000</span><span class="p">,</span> <span class="n">posterior1</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16923.59933856512
</pre></div>
</div>
</div>
</div>
<p>But can we do any better?</p>
<p>To find out, we can loop through a range of bids and find the one that maximizes expected gain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bids</span> <span class="o">=</span> <span class="n">posterior1</span><span class="o">.</span><span class="n">index</span>

<span class="n">gains</span> <span class="o">=</span> <span class="p">[</span><span class="n">expected_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior1</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span> <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">bids</span><span class="p">]</span>

<span class="n">expected_gain_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">gains</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here are the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bid ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Expected gain ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Player 1&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_108_0.png" src="_images/13_price_108_0.png" />
</div>
</div>
<p>And here is the optimal bid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain_series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22000.0
</pre></div>
</div>
</div>
</div>
<p>With that bid, the expected gain is about $17,400.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain_series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17384.899584430797
</pre></div>
</div>
</div>
</div>
<p>Recall that the estimated value of the prizes was $23,000.</p>
<p>The bid that maximizes the chance of winning is $21,000.</p>
<p>And the bid that maximizes your the expected gain is $22,000.</p>
<p><strong>Exercise:</strong> Do the same analysis for Player 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bids</span> <span class="o">=</span> <span class="n">posterior2</span><span class="o">.</span><span class="n">index</span>

<span class="n">gains</span> <span class="o">=</span> <span class="p">[</span><span class="n">expected_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior2</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span> <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">bids</span><span class="p">]</span>

<span class="n">expected_gain_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">gains</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here are the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Bid ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Expected gain ($)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Player 2&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/13_price_117_0.png" src="_images/13_price_117_0.png" />
</div>
</div>
<p>And here is the optimal bid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain_series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30000.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>Review<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>In this notebook</p>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/BiteSizeBayes/blob/master/13_xxx.ipynb">In the next notebook</a></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="12_binomial.html" title="previous page">The Binomial Distribution</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Allen B. Downey<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>